{% extends "base.html" %}

{% block title %}Model Training - Profiler Agentic Automation{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1><i class="fas fa-database"></i> Model Training Dashboard</h1>
        <p>Manage your knowledge base and vector database</p>
    </div>

    <div class="training-grid">
        <!-- Document Ingestion -->
        <div class="action-card">
            <div class="card-header">
                <i class="fas fa-file-upload"></i>
                <h3>Document Ingestion</h3>
            </div>
            <p>Upload and ingest documentation files (PDF, TXT, MD, JSON) into the vector database.</p>
            <a href="{{ url_for('ingest_docs_page') }}" class="btn btn-primary">
                <i class="fas fa-upload"></i> Upload Documents
            </a>
        </div>

        <!-- Framework Ingestion -->
        <div class="action-card">
            <div class="card-header">
                <i class="fas fa-code"></i>
                <h3>Framework Ingestion</h3>
            </div>
            <p>Ingest Python test framework code to help AI learn your coding patterns.</p>
            <a href="{{ url_for('ingest_framework_page') }}" class="btn btn-primary">
                <i class="fas fa-code-branch"></i> Ingest Framework
            </a>
        </div>

        <!-- Domain Knowledge Building -->
        <div class="action-card" style="border: 2px solid #f59e0b;">
            <div class="card-header">
                <i class="fas fa-brain" style="color: #f59e0b;"></i>
                <h3>Domain Knowledge <span style="background: #f59e0b; color: white; padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.7rem; margin-left: 0.5rem;">NEW</span></h3>
            </div>
            <p>Build hierarchical concept graphs from documentation to improve test case quality for complex features.</p>
            <a href="{{ url_for('domain_knowledge_page') }}" class="btn btn-primary" style="background: #f59e0b; border-color: #f59e0b;">
                <i class="fas fa-hammer"></i> Build Domain Knowledge
            </a>
        </div>

        <!-- PKG Extraction -->
        <div class="action-card" style="border: 2px solid #10b981;">
            <div class="card-header">
                <i class="fas fa-project-diagram" style="color: #10b981;"></i>
                <h3>PKG Extraction <span style="background: #10b981; color: white; padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.7rem; margin-left: 0.5rem;">NEW</span></h3>
            </div>
            <p>Extract Product Knowledge Graph with exact field names, ranges, constraints, and workflows from documentation.</p>
            <a href="{{ url_for('pkg_extraction_page') }}" class="btn btn-primary" style="background: #10b981; border-color: #10b981;">
                <i class="fas fa-sitemap"></i> Extract PKG
            </a>
        </div>

        <!-- View Documents -->
        <div class="action-card">
            <div class="card-header">
                <i class="fas fa-list"></i>
                <h3>View Documents</h3>
            </div>
            <p>Browse all ingested documents, view metadata, and manage your knowledge base.</p>
            <a href="{{ url_for('view_documents') }}" class="btn btn-primary">
                <i class="fas fa-eye"></i> View Documents
            </a>
        </div>

        <!-- Test RAG Retrieval -->
        <div class="action-card">
            <div class="card-header">
                <i class="fas fa-search"></i>
                <h3>Test RAG Retrieval</h3>
            </div>
            <p>Test different retrieval strategies (Semantic, Hybrid, Keyword, Context) and validate chunking.</p>
            <a href="{{ url_for('test_retrieval_page') }}" class="btn btn-primary">
                <i class="fas fa-vial"></i> Test Retrieval
            </a>
        </div>

        <!-- Vector DB Status -->
        <div class="action-card">
            <div class="card-header">
                <i class="fas fa-chart-line"></i>
                <h3>Database Status</h3>
            </div>
            <p>View vector database statistics, index size, and system configuration.</p>
            <a href="{{ url_for('vector_db_status') }}" class="btn btn-primary">
                <i class="fas fa-info-circle"></i> View Status
            </a>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="quick-stats">
        <h2>Quick Statistics</h2>
        <div class="stats-row">
            <div class="stat-box">
                <i class="fas fa-file-alt"></i>
                <div>
                    <h4 id="total-docs">Loading...</h4>
                    <p>Total Documents</p>
                </div>
            </div>
            <div class="stat-box">
                <i class="fas fa-cube"></i>
                <div>
                    <h4 id="total-chunks">Loading...</h4>
                    <p>Total Chunks</p>
                </div>
            </div>
            <div class="stat-box">
                <i class="fas fa-database"></i>
                <div>
                    <h4 id="index-size">Loading...</h4>
                    <p>Index Size</p>
                </div>
            </div>
            <div class="stat-box" style="border-left: 4px solid #f59e0b;">
                <i class="fas fa-brain" style="color: #f59e0b;"></i>
                <div>
                    <h4 id="domain-concepts">Loading...</h4>
                    <p>Domain Concepts</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Load stats
document.addEventListener('DOMContentLoaded', function() {
    // Load vector store stats
    fetch('/api/health')
        .then(response => response.json())
        .then(data => {
            // Update Quick Statistics
            const totalDocs = document.getElementById('total-docs');
            const totalChunks = document.getElementById('total-chunks');
            const indexSize = document.getElementById('index-size');

            if (totalDocs) {
                totalDocs.textContent = (data.total_documents || 0).toLocaleString();
            }
            if (totalChunks) {
                totalChunks.textContent = (data.total_chunks || 0).toLocaleString();
            }
            if (indexSize) {
                indexSize.textContent = (data.index_size || 0).toLocaleString();
            }
        })
        .catch(error => {
            console.error('Error loading stats:', error);
            // Set to 0 on error
            document.getElementById('total-docs').textContent = '0';
            document.getElementById('total-chunks').textContent = '0';
            document.getElementById('index-size').textContent = '0';
        });

    // Load domain knowledge stats
    fetch('/api/domain/status')
        .then(response => response.json())
        .then(data => {
            const domainConcepts = document.getElementById('domain-concepts');
            if (domainConcepts) {
                if (data.success && data.statistics) {
                    const total = data.statistics.total_concepts || 0;
                    domainConcepts.textContent = total.toLocaleString();
                    if (total === 0) {
                        domainConcepts.style.color = '#94a3b8';
                    }
                } else {
                    domainConcepts.textContent = '0';
                    domainConcepts.style.color = '#94a3b8';
                }
            }
        })
        .catch(error => {
            console.error('Error loading domain stats:', error);
            document.getElementById('domain-concepts').textContent = '0';
        });
});
</script>
{% endblock %}
